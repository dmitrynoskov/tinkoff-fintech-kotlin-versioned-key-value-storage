# API
### Создание нового пользователя
`POST /user`

Тело запроса:
```json
{
  "name":"Ivan Ivanov",
  "email":"ivanov02@gmail.com",
  "phone_number":"+74950000000"
}
```
Возвращает:
- 400 Bad Request - если данные не прошли валидацию или пользователь с таким номером уже существует, описание ошибки в теле ответа
- 200 OK - в случае, если нет ошибок
 
### Удаление пользователя
`DELETE /user/{phone_number}`

Также удаляет все записи (наборы key-value) пользователя

Возвращает:
- 400 Bad Request - если пользователя с таким номером телефона не существует, описание ошибки в теле ответа
- 200 OK - в случае, если нет ошибок

### Получение всех пользователей
`GET /user/all`

Поддерживает пагинацию, параметры запроса:
- `page` - номер страницы, начинается с 0
-  `per_page` - количество элементов на странице

Возвращает массив JSON пользователей в алфавитном порядке в формате:
```json
[
  {
    "name": "Ivan Ivanov",
    "email": "ivanov02@gmail.com",
    "phone_number": "+74950000000"
  },
  {
    "name": "Petr Petrov",
    "email": "petrov@mail.ru",
    "phone_number": "+74951111111"
  }
]
```

### Добавление одной пары key-value для пользователя
`POST /kv/single`

Тело запроса:
```json
{
  "phone_number":"+74950000000",
  "key":"key 1",
  "value":"value 1"
}
```
Добавляет ключ `key 1` со значением `value 1` либо обновляет значение по ключу `key 1`, если оно существовало
Если превышен лимит хранимых значений, удаляет самые старые записи по ключу `key 1` до тех пор, пока история изменений значений не станет помещаться в лимит

Возвращает:
- 400 Bad Request - если пользователя с таким номером телефона не существует, описание ошибки в теле ответа
- 200 OK - в случае, если нет ошибок 

### Добавление набора пар key-value для пользователя
`POST /kv/multi`

Тело запроса:
```json
{
  "phone_number":"+74950000000",
  "key_value":[
    {
      "key":"key 1",
      "value":"value 1"
    },
    {
      "key":"key 2",
      "value":"value 2"
    }
  ]
}
```
Добавляет произвольное количество пар key-value или обновляет значение value для существующих ключей
Все ключи в запросе должны быть уникальными

Возвращает:
- 400 Bad Request - если пользователя с таким номером телефона не существует или в запросе есть дублирующиеся ключи, описание ошибки в теле ответа
- 200 OK - в случае, если нет ошибок 

### Получение всех наборов key-value с наиболее актуальными значениями для пользователя
`GET /kv/{phone_number}`

Возвращает:
```json
{
  "user":{
    "name":"Ivan Ivanov",
    "email":"ivanov02@gmail.com",
    "phone_number":"+74950000000"
  },
  "key_value":[
    {
      "key":"key 1",
      "value":"value 1",
      "revision":0,
      "updated_at":"2021-02-09T18:31:42"
    },
    {
      "key":"key 2",
      "value":"value 2",
      "revision":0,
      "updated_at":"2021-02-09T18:31:42"
    }
  ]
}
```
где: 
- `revision` - порядковый номер изменения значения по данному ключу, начиная с 0 (0 - при создании) 
- `updated_at` - время последнего изменения значения в формате `YYYY-MM-DDThh:mm:ss` ISO 8601

400 Bad Request - если пользователя с таким номером телефона не существует, описание ошибки в теле ответа

### Получение  наборов key-value со значениями, актуальными на заданное время
`GET /kv/{phone_number}`

Параметры запроса:
- `time` - время в формате `YYYY-MM-DDThh:mm:ss` ISO 8601, по состоянию на которое необходимо вывести набор key-value

Возвращает:
```json
{
  "user":{
    "name":"Ivan Ivanov",
    "email":"ivanov02@gmail.com",
    "phone_number":"+74950000000"
  },
  "key_value":[
    {
      "key":"key 1",
      "value":"value 1",
      "revision":0,
      "updated_at":"2021-02-09T18:31:42"
    },
    {
      "key":"key 2",
      "value":"value 2",
      "revision":0,
      "updated_at":"2021-02-09T18:31:42"
    }
  ]
}
```
где: 
- `revision` - порядковый номер изменения значения по данному ключу, начиная с 0 (0 - при создании) 
- `updated_at` - время последнего изменения значения в формате `YYYY-MM-DDThh:mm:ss` ISO 8601

400 Bad Request - если пользователя с таким номером телефона не существует, описание ошибки в теле ответа

### Получение истории изменений значений для конкретного ключа
`GET /kv/history/{phone_number}`

Поддерживает пагинацию, параметры запроса:
- `key` - ключ, для которого необходимо вывести историю изменений значений
- `page` - номер страницы, начинается с 0
-  `per_page` - количество элементов на странице

Возвращает:
```json
{
  "user":{
    "name":"Ivan Ivanov",
    "email":"ivanov02@gmail.com",
    "phone_number":"+74950000000"
  },
  "key_value":[
    {
      "key":"key 1",
      "value":"value 1",
      "revision":0,
      "updated_at":"2021-02-09T18:31:42"
    },
    {
      "key":"key 1",
      "value":"value 2",
      "revision":1,
      "updated_at":"2021-02-10T20:00:15"
    }
  ]
}
```

400 Bad Request - если пользователя с таким номером телефона не существует

### Удаление всех записей для конкретного ключа
`DELETE /kv/{phone_number}`

Параметры запроса:
- `key` - ключ, который необходимо удалить

Возвращает:
- 400 Bad Request - если пользователя с таким номером телефона не существует или если у пользователя отсутствуют записи с данным ключом
- 200 OK - в случае, если нет ошибок
